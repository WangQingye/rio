var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,o=(e,a)=>{for(var t in a||(a={}))s.call(a,t)&&r(e,t,a[t]);if(l)for(var t of l(a))i.call(a,t)&&r(e,t,a[t]);return e},p=(e,l)=>a(e,t(l));import{b as d,_ as n,a as c}from"./MesuringTable.3021cce1.js";import{s as u}from"./index.8da61348.js";import{p as m,a as b,j as y,r as g,o as f,c as v,f as k,t as D,F as I,m as h,g as S,i as w,w as P,h as _,b as E,E as N,L as C}from"./vendor.cfd906a5.js";const O=e=>u({url:"/products-manage/product/addOrModify",method:"post",data:e}),V=e=>u({url:"/products-manage/query/products/detail",method:"get",params:e});const q={components:{ProductAdd:d},props:{pricesData:{type:Object,default:()=>({})},isInIndex:{type:Boolean}},emits:["dialog-submit"],name:"process-price-tag",setup(e,{emit:a}){console.log(e.pricesData);const t=y(!1),l=y(null);return{priceItems:[{label:"车工序价格",key:"lathePrice",required:!0},{label:"铣工序价格",key:"millingPrice",required:!0},{label:"钳工序价格",key:"fitterPrice",required:!0}],priceEditVisible:t,editItemData:l,handleEdit:a=>{t.value=!0,l.value=e.pricesData},editSubmit:async l=>{var s;await(s=p(o({productId:e.pricesData.id},l),{id:e.pricesData.workingPriceId||void 0}),u({url:"/products-manage/fill/price",method:"post",data:s})),w.success("填报成功"),t.value=!1,a("refresh")}}}},x=P();m("data-v-2b41c144");const A={style:{"font-weight":"bold"}},j={style:{"font-weight":"bold"}},T=_("填报价格");b();const R=x(((e,a,t,l,s,i)=>{const r=g("el-form-item"),o=g("el-button"),p=g("el-form"),d=g("ProductAdd");return f(),v(I,null,[k(p,{"label-width":"100px",inline:""},{default:x((()=>[k(r,{style:{width:"20%"},label:"序号 : "},{default:x((()=>[k("span",A,D(t.pricesData.serial),1)])),_:1}),(f(!0),v(I,null,h(l.priceItems,(e=>(f(),v(r,{style:{width:"20%"},key:e.key,label:`${e.label} : `},{default:x((()=>[k("span",j,D(t.pricesData[e.key]||"未填报"),1)])),_:2},1032,["label"])))),128)),k(r,null,{default:x((()=>[t.isInIndex?(f(),v(o,{key:0,type:"primary",size:"small",onClick:l.handleEdit},{default:x((()=>[T])),_:1},8,["onClick"])):S("",!0)])),_:1})])),_:1}),k(d,{visible:l.priceEditVisible,onClose:a[1]||(a[1]=e=>l.priceEditVisible=!1),itemData:l.editItemData,title:"填报价格",formItems:l.priceItems,key:"product-edit",onDialogSubmit:l.editSubmit},null,8,["visible","itemData","formItems","onDialogSubmit"])],64)}));q.render=R,q.__scopeId="data-v-2b41c144";const M={components:{BaseTable:n,MesuringTable:c,ProcessPriceTag:q,ProductAdd:d},props:{visible:{type:Boolean,required:!0},serial:{type:String},serialId:{type:String}},emits:["close","dialog-submit"],name:"product-add",setup(e,{emit:a}){const t=y([]),l=y({}),s=async()=>{var a,s;let i=await V({serial:e.serial,pageNo:1,pageSize:10});console.log(null==(a=i.data.records[0])?void 0:a.workings),l.value=i.data.records[0],t.value=null==(s=i.data.records[0])?void 0:s.workings};e.serial&&s();const i=y("process"),r=E((()=>e.visible));N(r,(()=>{1==r.value&&e.serial&&s()}));const d=y(!1),n=y({}),c=y(!1),m=y(null),b=y({});return{stepColumns:[{label:"工序",prop:"workingName"},{label:"操作者",prop:"user"},{label:"当前状态",prop:"status",slot:"status"},{label:"操作设备",prop:"deviceName"},{label:"接受产品数量",prop:"acceptAmt"},{label:"开工时间",prop:"startDate"},{label:"要求完工时间",prop:"needFinalDate"},{label:"实际完工时间",prop:"finalDate"},{label:"合格产品数量",prop:"qualAmt"},{label:"运行时间",prop:"runningDate"},{label:"最高记录",prop:"highRecord"},{label:"工序单价（元）",prop:"price"},{label:"备注",prop:"remark"}],stepItems:[{label:"工序",key:"workingName",disabled:!0},{label:"操作者",key:"user",type:"user"},{label:"接受产品数量",key:"acceptAmt"},{label:"要求完工时间",key:"needFinalDate",type:"date"},{label:"合格产品数量",key:"qualAmt"},{label:"运行时间",key:"runningDate"},{label:"最高记录",key:"highRecord"},{label:"工序单价（元）",key:"price"},{label:"备注",key:"remark",type:"textarea"}],meusringColumns:[{label:"量具名称",prop:"mesuringName"},{label:"量具规格",prop:"mesuringSpecs"},{label:"量具编号",prop:"mesuringId"},{label:"归属序号",prop:"fromIndex"},{label:"数量",prop:"num"},{label:"状态",prop:"status"},{label:"入库时间",prop:"inTime"},{label:"归还时间",prop:"returnTime"}],close:()=>{a("close")},activeName:i,stepEditVisible:d,stepEditItem:n,handleStepEdit:e=>{d.value=!0,n.value=e},stepEditSubmit:async e=>{var a;await(a=o({id:n.value.id},e),u({url:"/products-manage/fill/workings/detail",method:"post",data:a})),w.success("操作成功"),s()},partStepEditVisible:c,editPartStepItemData:m,stepTable:b,handleAddStep:()=>{c.value=!0,m.value=null},handleEditStep:e=>{c.value=!0,m.value=e},handleDeleteStep:e=>{C.confirm("确定要删除吗？","提示",{type:"warning"}).then((async()=>{var a;await(a={stepId:e.id},u({url:`/products-manage/remove/workings/${a.stepId}`,method:"delete",data:a})),w.success("删除成功"),b.value.refresh()})).catch((()=>{}))},editPartStepSubmit:async a=>{var t,l;console.log(a),await(l=p(o({id:null==(t=m.value)?void 0:t.id},a),{products:e.serialId}),u({url:"/products-manage/workings/addOrModify",method:"post",data:l})),w.success("操作成功"),b.value.refresh(),c.value=!1},partStepColumns:[{label:"工序",prop:"workingName"},{label:"操作设备",prop:"deviceName"},{label:"工序单价",prop:"price"}],editPartStepFormItems:[{label:"工序",key:"workingName",required:!0},{label:"操作设备",key:"deviceName",required:!0},{label:"工序单价",key:"price",required:!0}],processesList:t,pricesData:l,getProcessDetail:s}}},B=P();m("data-v-3c6ac165");const L=_("信息填报 "),F=_("添加工序"),U=_("编辑 "),$=_("删除"),z={class:"dialog-footer"},G=_("关 闭");b();const H=B(((e,a,t,l,s,i)=>{const r=g("ProcessPriceTag"),o=g("el-tag"),p=g("el-button"),d=g("BaseTable"),n=g("ProductAdd"),c=g("el-tab-pane"),u=g("MesuringTable"),m=g("el-tabs"),b=g("el-dialog");return f(),v(b,{"append-to-body":!0,title:`序号详情 - ${t.serial}`,modelValue:t.visible,"onUpdate:modelValue":a[4]||(a[4]=e=>t.visible=e),"destroy-on-close":!0,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"80%"},{footer:B((()=>[k("span",z,[k(p,{onClick:l.close},{default:B((()=>[G])),_:1},8,["onClick"])])])),default:B((()=>[k(m,{modelValue:l.activeName,"onUpdate:modelValue":a[3]||(a[3]=e=>l.activeName=e)},{default:B((()=>[k(c,{label:"生产过程",name:"process"},{default:B((()=>[k(r,{pricesData:l.pricesData,isInIndex:!0,onRefresh:l.getProcessDetail},null,8,["pricesData","onRefresh"]),k(d,{cols:l.stepColumns,tableRealData:l.processesList,key:t.serial},{status:B((e=>[k(o,{type:"NORMAL"===e.scopeData.status?"warning":"RUNNING"===e.scopeData.status?"primary":"success"},{default:B((()=>[_(D({NORMAL:"未开工",RUNNING:"已开工",CLOSED:"已完工"}[e.scopeData.status]),1)])),_:2},1032,["type"])])),operation:B((e=>[k(p,{type:"text",icon:"el-icon-edit",onClick:a=>l.handleStepEdit(e.scopeData)},{default:B((()=>[L])),_:2},1032,["onClick"])])),_:1},8,["cols","tableRealData"]),k(n,{visible:l.stepEditVisible,onClose:a[1]||(a[1]=e=>l.stepEditVisible=!1),title:"工序信息填报",formItems:l.stepItems,key:"product-edit",itemData:l.stepEditItem,onDialogSubmit:l.stepEditSubmit},null,8,["visible","formItems","itemData","onDialogSubmit"])])),_:1}),k(c,{label:"量具情况",name:"mesuring"},{default:B((()=>[k(u,{serialNum:t.serial},null,8,["serialNum"])])),_:1}),k(c,{label:"工序设置",name:"step"},{default:B((()=>[k(p,{type:"primary",icon:"el-icon-plus",style:{"margin-bottom":"10px"},onClick:l.handleAddStep},{default:B((()=>[F])),_:1},8,["onClick"]),k(d,{cols:l.partStepColumns,url:"/products-manage/query/workings",queryBase:{product:t.serialId},ref:"stepTable"},{operation:B((e=>[k(p,{type:"text",icon:"el-icon-edit",onClick:a=>l.handleEditStep(e.scopeData)},{default:B((()=>[U])),_:2},1032,["onClick"]),k(p,{type:"text",icon:"el-icon-delete",class:"color-warning",onClick:a=>l.handleDeleteStep(e.scopeData)},{default:B((()=>[$])),_:2},1032,["onClick"])])),_:1},8,["cols","queryBase"]),k(n,{visible:l.partStepEditVisible,onClose:a[2]||(a[2]=e=>l.partStepEditVisible=!1),title:"工序设置",itemData:l.editPartStepItemData,formItems:l.editPartStepFormItems,key:"product-edit",onDialogSubmit:l.editPartStepSubmit},null,8,["visible","itemData","formItems","onDialogSubmit"])])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["title","modelValue"])}));M.render=H,M.__scopeId="data-v-3c6ac165";export{q as _,M as a,O as e,V as g};
