var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,d=(e,a)=>{for(var l in a||(a={}))o.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))r.call(a,l)&&s(e,l,a[l]);return e};import{p as i,a as n,D as u,j as c,r as p,o as m,c as b,f as y,F as g,m as f,G as v,t as h,g as k,w as D,h as w,b as V,E as _,i as C,L as I}from"./vendor.cfd906a5.js";import{s as q}from"./index.8da61348.js";import{g as S}from"./user.181d4cce.js";const R=e=>q({url:"./table.json",method:"get",params:e});const E={name:"basetable",props:{cols:{type:Array,required:!0},url:{type:String},tableRealData:{type:Array},needOperation:{type:Boolean,default:!0},noBorder:{type:Boolean,default:!1},noPager:{type:Boolean,default:!1},queryBase:{type:Object,default:()=>{}}},setup(e,a){const l=u({pageNo:1,pageSize:10}),t=c([]),o=c(0),r=()=>{e.url&&((e,a)=>q({url:e,method:"get",params:a}))(e.url,d(d({},l),e.queryBase)).then((e=>{t.value=e.data.records,o.value=e.data.total||0}))};r();const s=c(!1);let i=u({name:"",address:""});return{query:l,tableData:t,pageTotal:o,editVisible:s,form:i,handleSearch:()=>{l.pageNo=1,r()},handlePageChange:e=>{l.pageNo=e,r()},handleDelete:e=>{ElMessageBox.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{ElMessage.success("删除成功"),t.value.splice(e,1)})).catch((()=>{}))},handleEdit:e=>{a.emit("edit",e)},refresh:e=>{console.log(e),l.pageNo=1;for(const a in e)l[a]=e[a];r()}}}},N=D();i("data-v-25505174");const U=w(" 导出表格"),T=y("i",{class:"el-icon-arrow-down el-icon--right"},null,-1),O=w("导出当页"),M=w("导出全部"),j={key:1},B={key:0,class:"pagination"};n();const x=N(((e,a,l,t,o,r)=>{const s=p("el-button"),d=p("el-dropdown-item"),i=p("el-dropdown-menu"),n=p("el-dropdown"),u=p("el-table-column"),c=p("el-table"),D=p("el-pagination");return m(),b("div",null,[y(n,{style:{float:"right","margin-bottom":"10px"}},{dropdown:N((()=>[y(i,null,{default:N((()=>[y(d,null,{default:N((()=>[O])),_:1}),y(d,null,{default:N((()=>[M])),_:1})])),_:1})])),default:N((()=>[y(s,{type:"primary",size:"small"},{default:N((()=>[U,T])),_:1})])),_:1}),y(c,{data:l.url?t.tableData:l.tableRealData,border:!l.noBorder,class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:N((()=>[(m(!0),b(g,null,f(l.cols,(a=>(m(),b(u,{key:a.prop,prop:a.prop,label:a.label},{default:N((l=>[a.slot?v(e.$slots,a.slot,{key:0,scopeData:l.row},void 0,!0):(m(),b("span",j,h(l.row[a.prop]),1))])),_:2},1032,["prop","label"])))),128)),l.needOperation?(m(),b(u,{key:0,label:"操作",width:"140"},{default:N((a=>[v(e.$slots,"operation",{scopeData:a.row},void 0,!0)])),_:1})):k("",!0)])),_:1},8,["data","border"]),l.noPager?k("",!0):(m(),b("div",B,[y(D,{background:"",layout:"total, prev, pager, next","current-page":t.query.pageNo,"page-size":t.query.pageSize,total:t.pageTotal,onCurrentChange:t.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])]))])}));E.render=x,E.__scopeId="data-v-25505174";const L={name:"user-select",props:{userData:{type:Number,required:!0}},setup(e,{emit:a}){const l=c(!1),t=c([]);return{onSelectChange:e=>{console.log(e),a("update:userData",e)},remoteMethod:async e=>{if(""!==e){l.value=!0;let a=await S({userName:e,pageNo:1,pageSize:100});t.value=a.data.records.map((e=>({value:e.id,label:e.realName}))),console.log(t),l.value=!1}else t.value=[]},options:t,loading:l}}},P=D(),A=P(((e,a,l,t,o,r)=>{const s=p("el-option"),d=p("el-select");return m(),b("div",null,[y(d,{modelValue:l.userData,"onUpdate:modelValue":a[1]||(a[1]=e=>l.userData=e),filterable:"",remote:"",placeholder:"输入名字搜索","remote-method":t.remoteMethod,clearable:"",onChange:t.onSelectChange,loading:t.loading},{default:P((()=>[(m(!0),b(g,null,f(t.options,(e=>(m(),b(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","remote-method","onChange","loading"])])}));L.render=A,L.__scopeId="data-v-0d574c64";const $={components:{UserSelect:L},props:{visible:{type:Boolean,required:!0},formItems:{type:Array,required:!0},itemData:{type:Object},propTitle:{type:String}},emits:["close","dialog-submit"],name:"product-add",setup(e,{emit:a}){const l=u({}),t=V((()=>e.visible)),o=c("编辑");_(t,(()=>{1==t.value?(e.itemData?o.value="编辑":o.value="添加",e.formItems.map((a=>{l[a.key]=e.itemData&&e.itemData[a.key]||""}))):Object.keys(l).map((e=>{delete l[e]}))}));const r=c();return{title:o,close:()=>{a("close")},saveEdit:async()=>{r.value.validate((e=>{e?a("dialog-submit",l):C.warning("请完善表格")}))},form:l,ruleForm:r}}},z=D();i("data-v-0c442797");const F={class:"dialog-footer"},Y=w("关 闭"),G=w("确 定");n();const H=z(((e,a,l,t,o,r)=>{const s=p("el-date-picker"),d=p("el-option"),i=p("el-select"),n=p("UserSelect"),u=p("el-input"),c=p("el-form-item"),v=p("el-form"),h=p("el-button"),k=p("el-dialog");return m(),b(k,{title:l.propTitle||t.title,modelValue:l.visible,"onUpdate:modelValue":a[1]||(a[1]=e=>l.visible=e),"destroy-on-close":!0,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":!0,width:"60%"},{footer:z((()=>[y("span",F,[y(h,{onClick:t.close},{default:z((()=>[Y])),_:1},8,["onClick"]),y(h,{type:"primary",onClick:t.saveEdit},{default:z((()=>[G])),_:1},8,["onClick"])])])),default:z((()=>[y(v,{"label-width":"170px",ref:"ruleForm",model:t.form,inline:""},{default:z((()=>[(m(!0),b(g,null,f(l.formItems,(e=>(m(),b(c,{style:e.width?`width:${e.width}`:"width: 48%",key:e.key,label:e.label,prop:e.key,rules:[{required:!1!==e.required,message:`请填写${e.label}`}],required:!1!==e.required},{default:z((()=>["date"==e.type?(m(),b(s,{key:0,modelValue:t.form[e.key],"onUpdate:modelValue":a=>t.form[e.key]=a,type:"date","value-format":"YYYY-MM-DD",disabled:e.disabled||l.itemData&&e.editDisabled,style:{width:"100%"},placeholder:"选择日期"},null,8,["modelValue","onUpdate:modelValue","disabled"])):"select"==e.type?(m(),b(i,{key:1,modelValue:t.form[e.key],"onUpdate:modelValue":a=>t.form[e.key]=a,type:"date",disabled:e.disabled||l.itemData&&e.editDisabled,style:{width:"100%"}},{default:z((()=>[(m(!0),b(g,null,f(e.options,(e=>(m(),b(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])):"user"==e.type?(m(),b(n,{key:2,userData:t.form[e.key],"onUpdate:userData":a=>t.form[e.key]=a,style:{width:"100%"}},null,8,["userData","onUpdate:userData"])):(m(),b(u,{key:3,modelValue:t.form[e.key],"onUpdate:modelValue":a=>t.form[e.key]=a,disabled:e.disabled||l.itemData&&e.editDisabled,type:e.type||"text",placeholder:e.placeholder},null,8,["modelValue","onUpdate:modelValue","disabled","type","placeholder"]))])),_:2},1032,["style","label","prop","rules","required"])))),128))])),_:1},8,["model"])])),_:1},8,["title","modelValue"])}));$.render=H,$.__scopeId="data-v-0c442797";const J={components:{BaseTable:E,ProductAdd:$},props:{serialNum:{type:String}},setup(e){const t=c({}),o=e=>{t.value.refresh(e)},r=c(!1);let s=c(null);const i=c(!1),n=c({}),u=c(!1),p=c(!1),m=c(!1),b=c(null);return{columns:[{label:"量具名称",prop:"name"},{label:"量具规格",prop:"specification"},{label:"量具编号",prop:"code"},{label:"归属序号",prop:"serialNum"},{label:"数量",prop:"numbers"},{label:"库房剩余数量",prop:"availableNums"},{label:"状态",prop:"status",slot:"status"},{label:"入库时间",prop:"putDate"},{label:"归还时间",prop:"returnDate"}],formItems:[{label:"量具名称",key:"name",required:!0},{label:"量具规格",key:"specification",required:!0},{label:"量具编号",key:"code",required:!0},{label:"归属序号",key:"serialNum",required:!0,placeholder:"请关联已存在的序号"},{label:"数量",type:"number",key:"numbers",required:!0},{label:"状态",key:"status",required:!0,type:"select",options:[{label:"在使用",value:"USE"},{label:"已归还",value:"RETURN"}]},{label:"入库时间",key:"putDate",type:"date",required:!0},{label:"归还时间",key:"returnDate",type:"date",required:!0}],editVisible:r,handleSearch:o,handleDelete:e=>{I.confirm("确定要删除吗？","提示",{type:"warning"}).then((async()=>{var a;await(a={mesureId:e.id},q({url:`/measures-manage/remove/${a.mesureId}`,method:"delete",data:a})),C.success("删除成功"),o()})).catch((()=>{}))},handleEdit:e=>{r.value=!0,s.value=e},showDetail:e=>{s.value=e,i.value=!0},editItemData:s,editSubmit:async e=>{var t,i,n,u;await(n=d({id:null==(t=s.value)?void 0:t.id},e),u={availableNums:e.numbers},i=a(n,l(u)),q({url:"/measures-manage/saveOrModify",method:"post",data:i})),C.success("操作成功"),r.value=!1,o()},handleAdd:()=>{console.log(111),r.value=!0,s.value=null},detailVisible:i,handleLendingRecords:e=>{s.value=e,u.value=!0},lendingRecordsColumns:[{label:"领用人",prop:"user"},{label:"领用日期",prop:"created"},{label:"还回日期",prop:"returnDate"},{label:"备注",prop:"remark"}],lendingRecordsVisible:u,showAddLend:()=>{p.value=!0},addLendVisible:p,addLendFormItems:[{label:"领用人",key:"user",required:!0,type:"user"},{label:"领用数量",key:"nums",required:!0,type:"number"},{label:"备注",key:"remark",required:!0,type:"textarea"}],addLendSubmit:async e=>{var a;await(a=d({measure:s.value.id},e),q({url:"/measures-manage/claims/add",method:"post",data:a})),C.success("操作成功"),p.value=!1,n.value.refresh()},showReturnMesuring:e=>{m.value=!0,b.value=e},returnMesuringVisible:m,returnMesuringItems:[{label:"归还数量",key:"nums",required:!0,type:"number"}],returnMesuringSubmit:async e=>{var a;await(a=d({id:b.value.id},e),q({url:"/measures-manage/claims/ret",method:"put",params:a})),C.success("操作成功"),m.value=!1,n.value.refresh()},mesureTable:t,lendRecordsTable:n,handleLendRecordsDelete:e=>{I.confirm("确定要删除吗？","提示",{type:"warning"}).then((async()=>{var a;await(a={recordId:e.id},q({url:`/measures-manage/claims/remove/${a.recordId}`,method:"delete",data:a})),C.success("删除成功"),n.value.refresh()})).catch((()=>{}))}}}},K=D();i("data-v-52a5e3f2");const Q=w("领用记录 "),W=w("编辑 "),X=w("删除"),Z=w(" 领用 "),ee=w("归还 "),ae=w("删除"),le={class:"dialog-footer"},te=w("关 闭");n();const oe=K(((e,a,l,t,o,r)=>{const s=p("el-tag"),d=p("el-link"),i=p("el-button"),n=p("BaseTable"),u=p("el-dialog"),c=p("ProductAdd");return m(),b("div",null,[y(n,{cols:t.columns,ref:"mesureTable",url:"/measures-manage/list",queryBase:{serialNum:l.serialNum},onEdit:t.handleEdit},{status:K((e=>[y(s,{type:{USE:"danger",STORAGE:"primary",RETURN:"success"}[e.scopeData.status]},{default:K((()=>[w(h({USE:"在使用",STORAGE:"在库房",RETURN:"已归还"}[e.scopeData.status]),1)])),_:2},1032,["type"])])),taskId:K((e=>[y(d,{href:"javascript:void(0)",type:"primary",onClick:a=>t.showDetail(e.scopeData)},{default:K((()=>[w(h(e.scopeData.taskId),1)])),_:2},1032,["onClick"])])),operation:K((e=>[y(i,{type:"text",icon:"el-icon-document",class:"color-success",onClick:a=>t.handleLendingRecords(e.scopeData)},{default:K((()=>[Q])),_:2},1032,["onClick"]),y(i,{type:"text",icon:"el-icon-edit",style:{"margin-left":"0"},onClick:a=>t.handleEdit(e.scopeData)},{default:K((()=>[W])),_:2},1032,["onClick"]),y(i,{type:"text",icon:"el-icon-delete",class:"color-danger",onClick:a=>t.handleDelete(e.scopeData)},{default:K((()=>[X])),_:2},1032,["onClick"])])),_:1},8,["cols","queryBase","onEdit"]),y(u,{title:`领用记录 - ${t.editItemData&&t.editItemData.name}`,modelValue:t.lendingRecordsVisible,"onUpdate:modelValue":a[2]||(a[2]=e=>t.lendingRecordsVisible=e),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"60%"},{footer:K((()=>[y("span",le,[y(i,{onClick:a[1]||(a[1]=e=>t.lendingRecordsVisible=!1)},{default:K((()=>[te])),_:1})])])),default:K((()=>[y(i,{type:"primary",icon:"el-icon-plus",style:{"margin-bottom":"20px"},onClick:t.showAddLend},{default:K((()=>[Z])),_:1},8,["onClick"]),y(n,{cols:t.lendingRecordsColumns,ref:"lendRecordsTable",queryBase:{measure:t.editItemData.id},url:"/measures-manage/claims"},{operation:K((e=>[e.scopeData.returnDate?k("",!0):(m(),b(i,{key:0,type:"text",icon:"el-icon-download",class:"color-success",onClick:a=>t.showReturnMesuring(e.scopeData)},{default:K((()=>[ee])),_:2},1032,["onClick"])),y(i,{type:"text",icon:"el-icon-delete",class:"color-danger",onClick:a=>t.handleLendRecordsDelete(e.scopeData)},{default:K((()=>[ae])),_:2},1032,["onClick"])])),_:1},8,["cols","queryBase"])])),_:1},8,["title","modelValue"]),y(c,{visible:t.editVisible,onClose:a[3]||(a[3]=e=>t.editVisible=!1),itemData:t.editItemData,formItems:t.formItems,key:"product-edit",onDialogSubmit:t.editSubmit},null,8,["visible","itemData","formItems","onDialogSubmit"]),y(c,{visible:t.addLendVisible,onClose:a[4]||(a[4]=e=>t.addLendVisible=!1),formItems:t.addLendFormItems,key:"lend-add",propTitle:"领用量具",onDialogSubmit:t.addLendSubmit},null,8,["visible","formItems","onDialogSubmit"]),y(c,{visible:t.returnMesuringVisible,onClose:a[5]||(a[5]=e=>t.returnMesuringVisible=!1),formItems:t.returnMesuringItems,propTitle:"归还量具",onDialogSubmit:t.returnMesuringSubmit},null,8,["visible","formItems","onDialogSubmit"])])}));J.render=oe,J.__scopeId="data-v-52a5e3f2";export{E as _,J as a,$ as b,L as c,R as f};
