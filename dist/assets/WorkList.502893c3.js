var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{i as s,b as o,a as i,j as u,d as p,p as n,h as d,L as c,w as m,r as b,o as f,c as y,e as h,l as v,t as k,q as D,g as S}from"./vendor.86c6712b.js";import{_ as I}from"./MesuringTable.4017a123.js";import{_ as w}from"./index.b3e4d661.js";import{a as C}from"./ProductDetail.c646594c.js";import{f as N,s as g}from"./worklist.f70fa175.js";const _={components:{BaseTable:I,ProductAdd:w,ProductDetail:C},name:"work-list",props:{userId:{type:String,default:void 0}},setup(e){const n=s({partName:"",productCode:"",partCode:""}),d=o({}),b=()=>{d.value.refresh(n)},f=o(null),y=o(!1),h=i(),v=u((()=>{var a;return e.userId||(null==(a=h.state.userInfo)?void 0:a.user.id)||""})),k=u((()=>{let e=h.state.userInfo.authorities[0].authority;return"SYS_QUALITY"===e||"SYS_ADMIN"===e})),D=o(!1),S=o([{label:"产品代号",prop:"productCode"},{label:"零件代号",prop:"partCode"},{label:"零件名称",prop:"partName"},{label:"工序",prop:"workingName"},{label:"操作设备",prop:"deviceName"},{label:"状态",prop:"status",slot:"status"},{label:"要求完工时间",prop:"needFinalDate"},{label:"开工时间",prop:"startDate"},{label:"完工时间",prop:"finalDate"},{label:"接受产品数量",prop:"acceptAmt"},{label:"合格产品数量",prop:"qualAmt"},{label:"工序单价（元）",prop:"price"},{label:"预计工资",prop:"checkWages"},{label:"结账状态",prop:"checkStatus"},{label:"结账时间",prop:"checkDate"}]);return p((()=>{k.value&&S.value.unshift({label:"序号",prop:"serial",slot:"serial"})})),{columns:S,query:n,handleSearch:b,handleWorkStatus:(e,a)=>{f.value=e,"start"===a?y.value=!0:"finish"===a&&c.confirm("确定完工吗？","提示",{type:"warning"}).then((async()=>{await N({workId:f.value.id}),m.success("操作成功"),b()})).catch((()=>{}))},editItemData:f,worklistTable:d,finishStartVisible:y,finishStartSubmit:async e=>{await g(((e,s)=>{for(var o in s||(s={}))l.call(s,o)&&r(e,o,s[o]);if(a)for(var o of a(s))t.call(s,o)&&r(e,o,s[o]);return e})({workId:f.value.id},e)),m.success("操作成功"),y.value=!1,b()},searchUserId:v,clickSerial:k,showSerialDetail:e=>{console.log(e),f.value=e,D.value=!0},serialDetailVisible:D}}},V=S();n("data-v-5c0b4f8d");const q=v("查询"),j={key:1},O=v("开工 "),A=v("完成");d();const U=V(((e,a,l,t,r,s)=>{var o,i,u;const p=b("el-input"),n=b("el-form-item"),d=b("el-button"),c=b("el-form"),m=b("el-link"),S=b("el-tag"),I=b("BaseTable"),w=b("ProductAdd"),C=b("ProductDetail");return f(),y("div",null,[h("div",{class:[l.userId?"":"container"]},[h(c,{inline:!0,model:t.query,class:"demo-form-inline"},{default:V((()=>[h(n,{label:"产品代号"},{default:V((()=>[h(p,{modelValue:t.query.productCode,"onUpdate:modelValue":a[1]||(a[1]=e=>t.query.productCode=e),placeholder:"产品代号"},null,8,["modelValue"])])),_:1}),h(n,{label:"零件代号"},{default:V((()=>[h(p,{modelValue:t.query.partCode,"onUpdate:modelValue":a[2]||(a[2]=e=>t.query.partCode=e),placeholder:"零件代号"},null,8,["modelValue"])])),_:1}),h(n,{label:"零件名称"},{default:V((()=>[h(p,{modelValue:t.query.partName,"onUpdate:modelValue":a[3]||(a[3]=e=>t.query.partName=e),placeholder:"零件名称"},null,8,["modelValue"])])),_:1}),h(n,null,{default:V((()=>[h(d,{type:"primary",onClick:t.handleSearch},{default:V((()=>[q])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),h(I,{cols:t.columns,ref:"worklistTable",needOperation:"",queryBase:t.searchUserId?{user:t.searchUserId}:{},url:"/work-shop-manage/work/pages"},{serial:V((e=>[t.clickSerial?(f(),y(m,{key:0,href:"javascript:void(0)",type:"primary",onClick:a=>t.showSerialDetail(e.scopeData)},{default:V((()=>[v(k(e.scopeData.serial),1)])),_:2},1032,["onClick"])):(f(),y("span",j,k(e.scopeData.serial),1))])),status:V((e=>[h(S,{type:"NORMAL"===e.scopeData.status?"warning":"RUNNING"===e.scopeData.status?"primary":"success"},{default:V((()=>[v(k({NORMAL:"未开工",RUNNING:"已开工",CLOSED:"已完工"}[e.scopeData.status]),1)])),_:2},1032,["type"])])),operation:V((e=>["NORMAL"==e.scopeData.status?(f(),y(d,{key:0,type:"primary",icon:"el-icon-video-play",style:{"margin-left":"0"},onClick:a=>t.handleWorkStatus(e.scopeData,"start")},{default:V((()=>[O])),_:2},1032,["onClick"])):D("",!0),"RUNNING"==e.scopeData.status?(f(),y(d,{key:1,type:"success",icon:"el-icon-finished",onClick:a=>t.handleWorkStatus(e.scopeData,"finish")},{default:V((()=>[A])),_:2},1032,["onClick"])):D("",!0)])),_:1},8,["cols","queryBase"])],2),h(w,{visible:t.finishStartVisible,onClose:a[4]||(a[4]=e=>t.finishStartVisible=!1),title:"开工填报",formItems:[{label:"接受产品数量",key:"acceptAmt",required:!1}],key:"product-edit",onDialogSubmit:t.finishStartSubmit},null,8,["visible","onDialogSubmit"]),(null==(o=t.editItemData)?void 0:o.serial)?(f(),y(C,{visible:t.serialDetailVisible,onClose:a[5]||(a[5]=e=>t.serialDetailVisible=!1),key:"detail",isZhiliang:!0,serialId:null==(i=t.editItemData)?void 0:i.id,serial:null==(u=t.editItemData)?void 0:u.serial},null,8,["visible","serialId","serial"])):D("",!0)])}));_.render=U,_.__scopeId="data-v-5c0b4f8d";export default _;
