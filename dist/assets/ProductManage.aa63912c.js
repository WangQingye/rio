var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,o=(e,o)=>{for(var d in o||(o={}))l.call(o,d)&&r(e,d,o[d]);if(a)for(var d of a(o))t.call(o,d)&&r(e,d,o[d]);return e};import{p as d,h as s,b as i,i as u,j as p,k as n,r as c,o as m,c as b,e as y,F as f,f as D,l as v,t as C,g,L as k,w as h,q as _}from"./vendor.86c6712b.js";import{_ as N,a as q}from"./MesuringTable.63d439f4.js";import{_ as V}from"./index.2615daba.js";import{_ as O,g as T,a as S,d as P,e as E}from"./ProductDetail.382fd02a.js";const I={components:{BaseTable:N,MesuringTable:q,ProcessPriceTag:O,ProductAdd:V},props:{visible:{type:Boolean,required:!0},partCode:{type:String},serialId:{type:String}},emits:["close","dialog-submit"],name:"product-add",setup(e,{emit:a}){const l=i([]),t=i(0),r=async()=>{let a=await T(o({partCode:e.partCode},d));l.value=a.data.records,t.value=a.data.total},d=u({serial:"",pageNo:1,pageSize:10}),s=u({}),c=i("process"),m=p((()=>e.visible));n(m,(()=>{1==m.value&&r()}));return{stepColumns:[{label:"工序",prop:"workingName"},{label:"操作者",prop:"userName"},{label:"当前状态",prop:"status",slot:"status"},{label:"操作设备",prop:"deviceName"},{label:"接受产品数量",prop:"acceptAmt"},{label:"开工时间",prop:"startDate"},{label:"要求完工时间",prop:"needFinalDate"},{label:"实际完工时间",prop:"finalDate"},{label:"合格产品数量",prop:"qualAmt"},{label:"运行时间",prop:"runningDate"},{label:"最高记录",prop:"highRecord"},{label:"工序单价（元）",prop:"price"},{label:"备注",prop:"remark"}],meusringColumns:[{label:"量具名称",prop:"mesuringName"},{label:"量具规格",prop:"mesuringSpecs"},{label:"量具编号",prop:"mesuringId"},{label:"归属序号",prop:"fromIndex"},{label:"数量",prop:"num"},{label:"状态",prop:"status"},{label:"入库时间",prop:"inTime"},{label:"归还时间",prop:"returnTime"}],close:()=>{a("close")},activeName:c,saveEdit:()=>{a("dialog-submit",s)},form:s,processQuery:d,handleProcessSearch:()=>{d.pageNo=1,r()},pageTotal:t,handlePageChange:e=>{d.pageNo=e,r()},processesList:l}}},A=g();d("data-v-f02a4d84");const R=v("查询"),w={class:"pagination"},L={class:"dialog-footer"},U=v("关 闭");s();const j=A(((e,a,l,t,r,o)=>{const d=c("el-input"),s=c("el-form-item"),i=c("el-button"),u=c("el-form"),p=c("ProcessPriceTag"),n=c("el-tag"),g=c("BaseTable"),k=c("el-card"),h=c("el-pagination"),_=c("el-tab-pane"),N=c("el-tabs"),q=c("el-dialog");return m(),b(q,{"append-to-body":!0,title:`零件生产详情 - ${l.partCode}`,modelValue:l.visible,"onUpdate:modelValue":a[3]||(a[3]=e=>l.visible=e),"show-close":!1,"destroy-on-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"80%"},{footer:A((()=>[y("span",L,[y(i,{onClick:t.close},{default:A((()=>[U])),_:1},8,["onClick"])])])),default:A((()=>[y(N,{modelValue:t.activeName,"onUpdate:modelValue":a[2]||(a[2]=e=>t.activeName=e)},{default:A((()=>[y(_,{label:"生产情况",name:"process",class:"part-info"},{default:A((()=>[y(u,{inline:!0,model:t.processQuery,class:"demo-form-inline"},{default:A((()=>[y(s,{label:"序号"},{default:A((()=>[y(d,{modelValue:t.processQuery.serial,"onUpdate:modelValue":a[1]||(a[1]=e=>t.processQuery.serial=e),placeholder:"序号"},null,8,["modelValue"])])),_:1}),y(s,null,{default:A((()=>[y(i,{type:"primary",onClick:t.handleProcessSearch},{default:A((()=>[R])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),(m(!0),b(f,null,D(t.processesList,(e=>(m(),b(k,{class:"part-card",key:e.id,style:{padding:"0","margin-bottom":"10px"}},{default:A((()=>[y(p,{pricesData:e},null,8,["pricesData"]),y(g,{noBorder:"",noPager:"",cols:t.stepColumns,tableRealData:e.workings,key:e.id,needOperation:!1},{status:A((e=>[y(n,{type:"NORMAL"===e.scopeData.status?"warning":"RUNNING"===e.scopeData.status?"primary":"success"},{default:A((()=>[v(C({NORMAL:"未开工",RUNNING:"已开工",CLOSED:"已完工"}[e.scopeData.status]),1)])),_:2},1032,["type"])])),_:2},1032,["cols","tableRealData"])])),_:2},1024)))),128)),y("div",w,[y(h,{background:"",layout:"total, prev, pager, next","current-page":t.processQuery.pageNo,"page-size":t.processQuery.pageSize,total:t.pageTotal,onCurrentChange:t.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["title","modelValue"])}));I.render=j,I.__scopeId="data-v-f02a4d84";const Q={components:{BaseTable:N,ProductAdd:V,ProductDetail:S,PartDetail:I},name:"product-manage",setup(){const e=u({serial:"",code:"",productCode:"",partCode:"",partName:"",remark:"",status:""}),a=i(),l=()=>{a.value.refresh(e)},t=i(!1),r=i({}),d=i(!1),s=i(!1);return{columns:[{label:"序号",prop:"serial",slot:"serial"},{label:"任务号",prop:"code"},{label:"产品代号",prop:"productCode"},{label:"零件代号",prop:"partCode",slot:"partCode"},{label:"零件名称",prop:"partName"},{label:"图纸工序",prop:"processes"},{label:"本厂实际工序",prop:"factoryProcess",width:"130",slot:"factoryProcess"},{label:"原材料存放点",prop:"materialStorage"},{label:"回厂数量",prop:"returnQuantity"},{label:"回厂日期",prop:"returnDate"},{label:"调度备注",prop:"remark"},{label:"甲方要求回厂时间",prop:"requiredReturnDate"},{label:"状态",prop:"status",slot:"status"},{label:"上账备注",prop:"remark1"},{label:"出厂数量",prop:"exQuantity"},{label:"出厂时间",prop:"deliveryTime"},{label:"最终甲方检验合格数",prop:"requiredQualified"}],formItems:[{label:"序号",key:"serial",required:!0,editDisabled:!0},{label:"任务号",key:"code",required:!0},{label:"产品代号",key:"productCode",required:!0},{label:"零件代号",key:"partCode",required:!0,editDisabled:!0},{label:"零件名称",key:"partName",required:!0},{label:"图纸工序",key:"processes",required:!1},{label:"回厂数量",key:"returnQuantity",required:!1},{label:"回厂日期",key:"returnDate",required:!1,type:"date"},{label:"原材料存放点",key:"materialStorage",required:!1},{label:"调度备注",key:"remark",hideOnAdd:!0,required:!1},{label:"甲方要求回厂时间",key:"requiredReturnDate",required:!1,hideOnAdd:!0,type:"date"},{label:"状态",key:"status",required:!1,type:"select",hideOnAdd:!0,options:[{label:"未开工",value:"NOT_STARTED"},{label:"生产中",value:"PROCESSING"},{label:"已完工",value:"COMPLETED"},{label:"已完结",value:"CLOSED"}]},{label:"上账备注",key:"remark1",required:!1,hideOnAdd:!0},{label:"出厂数量",key:"exQuantity",required:!1,hideOnAdd:!0},{label:"出厂时间",key:"deliveryTime",required:!1,hideOnAdd:!0,type:"date"},{label:"最终甲方检验合格数",key:"requiredQualified",hideOnAdd:!0,required:!1}],query:e,editVisible:t,handleSearch:l,handleDelete:e=>{k.confirm("确定要删除吗？","提示",{type:"warning"}).then((async()=>{await P({id:e.id}),h.success("删除成功"),l()})).catch((()=>{}))},handleEdit:e=>{t.value=!0,r.value=e},showDetail:e=>{d.value=!0,r.value=e},editItemData:r,editSubmit:async e=>{var a;if(r.value){if("COMPLETED"!==r.value.status||"CLOSED"!==e.status)return void h.error("状态只能由已完工修改为已完结")}else e.status="NOT_STARTED";await E(o({id:null==(a=r.value)?void 0:a.id},e)),h.success("添加成功"),t.value=!1,l()},handleAdd:()=>{t.value=!0,r.value=null},detailVisible:d,partDetailVisible:s,showPartDetail:e=>{s.value=!0,r.value=e},productTable:a}}},x=g();d("data-v-2d6dd218");const M={class:"container"},G=v("查询"),B=v("添加批次"),z=v("编辑 "),$=v("删除");s();const F=x(((e,a,l,t,r,o)=>{var d,s,i,u,p;const n=c("el-input"),g=c("el-form-item"),k=c("el-option"),h=c("el-select"),N=c("el-button"),q=c("el-form"),V=c("el-tag"),O=c("el-link"),T=c("BaseTable"),S=c("ProductAdd"),P=c("ProductDetail"),E=c("PartDetail");return m(),b("div",null,[y("div",M,[y(q,{inline:!0,model:t.query,class:"demo-form-inline"},{default:x((()=>[y(g,{label:"序号"},{default:x((()=>[y(n,{modelValue:t.query.serial,"onUpdate:modelValue":a[1]||(a[1]=e=>t.query.serial=e),placeholder:"序号"},null,8,["modelValue"])])),_:1}),y(g,{label:"任务号"},{default:x((()=>[y(n,{modelValue:t.query.code,"onUpdate:modelValue":a[2]||(a[2]=e=>t.query.code=e),placeholder:"任务号"},null,8,["modelValue"])])),_:1}),y(g,{label:"产品代号"},{default:x((()=>[y(n,{modelValue:t.query.productCode,"onUpdate:modelValue":a[3]||(a[3]=e=>t.query.productCode=e),placeholder:"产品代号"},null,8,["modelValue"])])),_:1}),y(g,{label:"零件代号"},{default:x((()=>[y(n,{modelValue:t.query.partCode,"onUpdate:modelValue":a[4]||(a[4]=e=>t.query.partCode=e),placeholder:"零件代号"},null,8,["modelValue"])])),_:1}),y(g,{label:"零件名称"},{default:x((()=>[y(n,{modelValue:t.query.partName,"onUpdate:modelValue":a[5]||(a[5]=e=>t.query.partName=e),placeholder:"零件名称"},null,8,["modelValue"])])),_:1}),y(g,{label:"调度备注"},{default:x((()=>[y(n,{modelValue:t.query.remark,"onUpdate:modelValue":a[6]||(a[6]=e=>t.query.remark=e),placeholder:"调度备注"},null,8,["modelValue"])])),_:1}),y(g,{label:"状态"},{default:x((()=>[y(h,{modelValue:t.query.status,"onUpdate:modelValue":a[7]||(a[7]=e=>t.query.status=e),placeholder:"状态",clearable:"",class:"handle-select mr10"},{default:x((()=>[y(k,{label:"未开工",value:"NOT_STARTED"}),y(k,{label:"生产中",value:"PROCESSING"}),y(k,{label:"已完工",value:"COMPLETED"}),y(k,{label:"已完结",value:"CLOSED"})])),_:1},8,["modelValue"])])),_:1}),y(g,null,{default:x((()=>[y(N,{type:"primary",onClick:t.handleSearch},{default:x((()=>[G])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),y(N,{type:"primary",icon:"el-icon-plus",style:{"margin-bottom":"20px"},onClick:t.handleAdd},{default:x((()=>[B])),_:1},8,["onClick"]),y(T,{cols:t.columns,needExport:"",ref:"productTable",url:"/products-manage/product/list"},{status:x((e=>[y(V,{type:"COMPLETED"===e.scopeData.status?"success":"NOT_STARTED"===e.scopeData.status?"danger":""},{default:x((()=>[v(C({NOT_STARTED:"未开工",PROCESSING:"生产中",COMPLETED:"已完工",CLOSED:"已完结"}[e.scopeData.status]),1)])),_:2},1032,["type"])])),factoryProcess:x((e=>[(m(!0),b(f,null,D(e.scopeData.workings,(e=>(m(),b(O,{href:"javascript:void(0)",style:{display:"block"},key:e.id,type:{NORMAL:"danger",RUNNING:"success",CLOSED:"primary"}[e.status]},{default:x((()=>[v(C(`${e.workingName}-${{NORMAL:"未开工",RUNNING:"进行中",CLOSED:"已完工"}[e.status]}`),1)])),_:2},1032,["type"])))),128))])),serial:x((e=>[y(O,{href:"javascript:void(0)",type:"primary",onClick:a=>t.showDetail(e.scopeData)},{default:x((()=>[v(C(e.scopeData.serial),1)])),_:2},1032,["onClick"])])),partCode:x((e=>[y(O,{href:"javascript:void(0)",type:"primary",onClick:a=>t.showPartDetail(e.scopeData)},{default:x((()=>[v(C(e.scopeData.partCode),1)])),_:2},1032,["onClick"])])),operation:x((e=>[y(N,{type:"text",icon:"el-icon-edit",onClick:a=>t.handleEdit(e.scopeData)},{default:x((()=>[z])),_:2},1032,["onClick"]),y(N,{type:"text",icon:"el-icon-delete",class:"red",onClick:a=>t.handleDelete(e.scopeData)},{default:x((()=>[$])),_:2},1032,["onClick"])])),_:1},8,["cols"])]),y(S,{visible:t.editVisible,onClose:a[8]||(a[8]=e=>t.editVisible=!1),itemData:t.editItemData,formItems:t.formItems,key:"product-edit",onDialogSubmit:t.editSubmit},null,8,["visible","itemData","formItems","onDialogSubmit"]),(null==(d=t.editItemData)?void 0:d.id)?(m(),b(P,{visible:t.detailVisible,onClose:a[9]||(a[9]=e=>t.detailVisible=!1),key:"detail",serialId:null==(s=t.editItemData)?void 0:s.id,serial:null==(i=t.editItemData)?void 0:i.serial},null,8,["visible","serialId","serial"])):_("",!0),t.editItemData?(m(),b(E,{visible:t.partDetailVisible,onClose:a[10]||(a[10]=e=>t.partDetailVisible=!1),key:"detail1",serialId:null==(u=t.editItemData)?void 0:u.id,partCode:null==(p=t.editItemData)?void 0:p.partCode},null,8,["visible","serialId","partCode"])):_("",!0)])}));Q.render=F,Q.__scopeId="data-v-2d6dd218";export default Q;
