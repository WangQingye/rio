var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,o=(e,a)=>{for(var t in a||(a={}))i.call(a,t)&&r(e,t,a[t]);if(l)for(var t of l(a))s.call(a,t)&&r(e,t,a[t]);return e},d=(e,l)=>a(e,t(l));import{_ as n,a as p}from"./MesuringTable.4017a123.js";import{s as u,_ as c}from"./index.b3e4d661.js";import{p as m,h as b,b as g,r as y,o as v,c as f,e as h,t as k,F as S,f as D,q as I,w as C,g as _,l as w,j as N,k as E,a as T,L as P}from"./vendor.86c6712b.js";const O=e=>u({url:"/products-manage/product/addOrModify",method:"post",data:e}),V=e=>u({url:`/products-manage/remove/product/${e.id}`,method:"delete",data:e}),A=e=>u({url:"/products-manage/query/products/detail",method:"get",params:e}),q=e=>u({url:"/products-manage/fill/workings/detail",method:"post",data:e});const x={components:{ProductAdd:c},props:{pricesData:{type:Object,default:()=>({})},isInIndex:{type:Boolean}},emits:["dialog-submit"],name:"process-price-tag",setup(e,{emit:a}){console.log(e.pricesData);const t=g(!1),l=g(null);return{priceItems:[{label:"车工序价格",key:"lathePrice",required:!0},{label:"铣工序价格",key:"millingPrice",required:!0},{label:"钳工序价格",key:"fitterPrice",required:!0}],priceEditVisible:t,editItemData:l,handleEdit:a=>{t.value=!0,l.value=e.pricesData},editSubmit:async l=>{var i;await(i=d(o({productId:e.pricesData.id},l),{id:e.pricesData.workingPriceId||void 0}),u({url:"/products-manage/fill/price",method:"post",data:i})),C.success("填报成功"),t.value=!1,a("refresh")}}}},R=_();m("data-v-59c9f8aa");const j={style:{"font-weight":"bold"}},z={style:{"font-weight":"bold"}},M=w("填报价格");b();const Y=R(((e,a,t,l,i,s)=>{const r=y("el-form-item"),o=y("el-button"),d=y("el-form"),n=y("ProductAdd");return v(),f(S,null,[h(d,{"label-width":"100px",inline:""},{default:R((()=>[h(r,{style:{width:"20%"},label:"序号 : "},{default:R((()=>[h("span",j,k(t.pricesData.serial),1)])),_:1}),(v(!0),f(S,null,D(l.priceItems,(e=>(v(),f(r,{style:{width:"20%"},key:e.key,label:`${e.label} : `},{default:R((()=>[h("span",z,k(t.pricesData[e.key]||"未填报"),1)])),_:2},1032,["label"])))),128)),h(r,null,{default:R((()=>[t.isInIndex?(v(),f(o,{key:0,type:"primary",size:"small",onClick:l.handleEdit},{default:R((()=>[M])),_:1},8,["onClick"])):I("",!0)])),_:1})])),_:1}),h(n,{visible:l.priceEditVisible,onClose:a[1]||(a[1]=e=>l.priceEditVisible=!1),itemData:l.editItemData,title:"填报价格",formItems:l.priceItems,key:"product-edit",onDialogSubmit:l.editSubmit},null,8,["visible","itemData","formItems","onDialogSubmit"])],64)}));x.render=Y,x.__scopeId="data-v-59c9f8aa";const Z={components:{BaseTable:n,MesuringTable:p,ProcessPriceTag:x,ProductAdd:c},props:{isZhiliang:{type:Boolean,default:!1},visible:{type:Boolean,required:!0},serial:{type:String},serialId:{type:String}},emits:["close","dialog-submit"],name:"product-add",setup(e,{emit:a}){const t=g([]),l=g({}),i=async()=>{var a,i;let s=await A({serial:e.serial,pageNo:1,pageSize:10});console.log(null==(a=s.data.records[0])?void 0:a.workings),l.value=s.data.records[0],t.value=null==(i=s.data.records[0])?void 0:i.workings};e.serial&&i();const s=g("process"),r=N((()=>e.visible));E(r,(()=>{1==r.value&&e.serial&&i()}));const n=g(!1),p=g({}),c=g(!1),m=g(null),b=g({}),y=g(!1),v=g({}),f=T().state.userInfo.authorities[0].authority,h=N((()=>{var e;return[{label:"工序",key:"workingName",disabled:!0},{label:"操作者",key:"user",type:"user",disabled:"NORMAL"!==(null==(e=p.value)?void 0:e.status)},{label:"要求完工时间",key:"needFinalDate",type:"date"},{label:"运行时间",key:"runningDate",noVisible:"SYS_CONTACT"==f},{label:"最高记录",key:"highRecord",noVisible:"SYS_CONTACT"==f},{label:"工序单价（元）",key:"price",noVisible:"SYS_CONTACT"==f},{label:"备注",key:"remark",type:"textarea",required:!1},{label:"接受产品数量",key:"acceptAmt",placeholder:"分配时无需填写，由员工填写",required:!1},{label:"合格产品数量",key:"qualAmt",placeholder:"分配时无需填写，由员工填写",required:!1}]}));return{stepColumns:N((()=>[{label:"工序",prop:"workingName"},{label:"操作者",prop:"userName"},{label:"当前状态",prop:"status",slot:"status"},{label:"操作设备",prop:"deviceName"},{label:"接受产品数量",prop:"acceptAmt"},{label:"开工时间",prop:"startDate"},{label:"要求完工时间",prop:"needFinalDate"},{label:"实际完工时间",prop:"finalDate"},{label:"合格产品数量",prop:"qualAmt"},{label:"运行时间",prop:"runningDate",noVisible:"SYS_CONTACT"==f},{label:"最高记录",prop:"highRecord",noVisible:"SYS_CONTACT"==f},{label:"工序单价（元）",prop:"price",noVisible:"SYS_CONTACT"==f},{label:"备注",prop:"remark"}])),stepItems:h,meusringColumns:[{label:"量具名称",prop:"mesuringName"},{label:"量具规格",prop:"mesuringSpecs"},{label:"量具编号",prop:"mesuringId"},{label:"归属序号",prop:"fromIndex"},{label:"数量",prop:"num"},{label:"状态",prop:"status"},{label:"入库时间",prop:"inTime"},{label:"归还时间",prop:"returnTime"}],close:()=>{a("close")},activeName:s,stepEditVisible:n,stepEditItem:p,handleStepEdit:e=>{n.value=!0,p.value=e},stepEditSubmit:async e=>{await q(o({id:p.value.id},e)),C.success("操作成功"),n.value=!1,i()},partStepEditVisible:c,editPartStepItemData:m,stepTable:b,handleAddStep:()=>{c.value=!0,m.value=null},handleEditStep:e=>{c.value=!0,m.value=e},handleDeleteStep:e=>{P.confirm("确定要删除吗？","提示",{type:"warning"}).then((async()=>{var a;await(a={stepId:e.id},u({url:`/products-manage/remove/workings/${a.stepId}`,method:"delete",data:a})),C.success("删除成功"),b.value.refresh(),i()})).catch((()=>{}))},editPartStepSubmit:async a=>{var t,l;console.log(a),await(l=d(o({id:null==(t=m.value)?void 0:t.id},a),{products:e.serialId}),u({url:"/products-manage/workings/addOrModify",method:"post",data:l})),C.success("操作成功"),b.value.refresh(),c.value=!1,i()},partStepColumns:[{label:"工序",prop:"workingName"},{label:"操作设备",prop:"deviceName"},{label:"工序单价（元）",prop:"price"}],editPartStepFormItems:[{label:"工序",key:"workingName",required:!0},{label:"操作设备",key:"deviceName",required:!0},{label:"工序单价",key:"price",required:!0,type:"number"}],processesList:t,pricesData:l,getProcessDetail:i,zhiliangEditVisible:y,zhiliangEditItem:v,handleZhiliangEdit:e=>{y.value=!0,v.value=e},zhiliangEditSubmit:async e=>{await q(o({id:v.value.id},e)),C.success("操作成功"),y.value=!1,i()},zhiliangFormItems:[{label:"合格产品数量",key:"qualAmt"},{label:"备注",key:"remark",type:"textarea",required:!1}],userType:f}}},B=_();m("data-v-6a504bb2");const F=w("信息填报 "),L=w("合格数填报 "),U=w("添加工序"),$=w("编辑 "),G=w("删除"),H={class:"dialog-footer"},J=w("关 闭");b();const K=B(((e,a,t,l,i,s)=>{const r=y("ProcessPriceTag"),o=y("el-tag"),d=y("el-button"),n=y("BaseTable"),p=y("ProductAdd"),u=y("el-tab-pane"),c=y("MesuringTable"),m=y("el-tabs"),b=y("el-dialog");return v(),f(b,{"append-to-body":!0,title:`序号详情 - ${t.serial}`,modelValue:t.visible,"onUpdate:modelValue":a[5]||(a[5]=e=>t.visible=e),"destroy-on-close":!0,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"80%"},{footer:B((()=>[h("span",H,[h(d,{onClick:l.close},{default:B((()=>[J])),_:1},8,["onClick"])])])),default:B((()=>[h(m,{modelValue:l.activeName,"onUpdate:modelValue":a[4]||(a[4]=e=>l.activeName=e)},{default:B((()=>[h(u,{label:"生产过程",name:"process"},{default:B((()=>[t.isZhiliang||"SYS_PRODUCT"===l.userType?I("",!0):(v(),f(r,{key:0,pricesData:l.pricesData,isInIndex:!0,onRefresh:l.getProcessDetail},null,8,["pricesData","onRefresh"])),h(n,{cols:l.stepColumns,tableRealData:l.processesList,key:t.serial},{status:B((e=>[h(o,{type:"NORMAL"===e.scopeData.status?"warning":"RUNNING"===e.scopeData.status?"primary":"success"},{default:B((()=>[w(k({NORMAL:"未开工",RUNNING:"已开工",CLOSED:"已完工"}[e.scopeData.status]),1)])),_:2},1032,["type"])])),operation:B((e=>[t.isZhiliang?t.isZhiliang?(v(),f(d,{key:1,type:"text",icon:"el-icon-edit",onClick:a=>l.handleZhiliangEdit(e.scopeData)},{default:B((()=>[L])),_:2},1032,["onClick"])):I("",!0):(v(),f(d,{key:0,type:"text",icon:"el-icon-edit",onClick:a=>l.handleStepEdit(e.scopeData)},{default:B((()=>[F])),_:2},1032,["onClick"]))])),_:1},8,["cols","tableRealData"]),h(p,{visible:l.stepEditVisible,onClose:a[1]||(a[1]=e=>l.stepEditVisible=!1),title:"工序信息填报",formItems:l.stepItems,key:"product-edit",itemData:l.stepEditItem,onDialogSubmit:l.stepEditSubmit},null,8,["visible","formItems","itemData","onDialogSubmit"]),h(p,{visible:l.zhiliangEditVisible,onClose:a[2]||(a[2]=e=>l.zhiliangEditVisible=!1),title:"合格数填报",formItems:l.zhiliangFormItems,key:"product-edit",itemData:l.zhiliangEditItem,onDialogSubmit:l.zhiliangEditSubmit},null,8,["visible","formItems","itemData","onDialogSubmit"])])),_:1}),t.isZhiliang?I("",!0):(v(),f(u,{key:0,label:"量具情况",name:"mesuring"},{default:B((()=>[h(c,{serialNum:t.serial},null,8,["serialNum"])])),_:1})),t.isZhiliang||"SYS_CONTACT"==l.userType?I("",!0):(v(),f(u,{key:1,label:"工序设置",name:"step"},{default:B((()=>[h(d,{type:"primary",icon:"el-icon-plus",style:{"margin-bottom":"10px"},onClick:l.handleAddStep},{default:B((()=>[U])),_:1},8,["onClick"]),h(n,{cols:l.partStepColumns,url:"/products-manage/query/workings",queryBase:{product:t.serialId},ref:"stepTable"},{operation:B((e=>[h(d,{type:"text",icon:"el-icon-edit",onClick:a=>l.handleEditStep(e.scopeData)},{default:B((()=>[$])),_:2},1032,["onClick"]),h(d,{type:"text",icon:"el-icon-delete",class:"color-warning",onClick:a=>l.handleDeleteStep(e.scopeData)},{default:B((()=>[G])),_:2},1032,["onClick"])])),_:1},8,["cols","queryBase"]),h(p,{visible:l.partStepEditVisible,onClose:a[3]||(a[3]=e=>l.partStepEditVisible=!1),title:"工序设置",itemData:l.editPartStepItemData,formItems:l.editPartStepFormItems,key:"product-edit",onDialogSubmit:l.editPartStepSubmit},null,8,["visible","itemData","formItems","onDialogSubmit"])])),_:1}))])),_:1},8,["modelValue"])])),_:1},8,["title","modelValue"])}));Z.render=K,Z.__scopeId="data-v-6a504bb2";export{x as _,Z as a,V as d,O as e,A as g};
