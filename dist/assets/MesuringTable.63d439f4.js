var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,n=(e,a)=>{for(var l in a||(a={}))r.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&s(e,l,a[l]);return e};import{p as i,h as d,i as u,j as c,b as p,r as m,o as b,c as y,q as g,e as v,F as f,f as h,H as k,t as D,g as w,l as C,L as R,w as I}from"./vendor.86c6712b.js";import{s as q,_ as S}from"./index.2615daba.js";const _={name:"basetable",props:{cols:{type:Array,required:!0},url:{type:String},tableRealData:{type:Array},needOperation:{type:Boolean,default:!0},noBorder:{type:Boolean,default:!1},noPager:{type:Boolean,default:!1},needExport:{type:Boolean,default:!1},queryBase:{type:Object,default:()=>{}}},setup(e,a){const l=u({pageNo:1,pageSize:10}),t=c((()=>{let a=n(n({},l),e.queryBase);for(const e in a)if(Object.hasOwnProperty.call(a,e)){""===a[e]&&(a[e]=void 0)}return a})),r=p([]),o=p(0),s=()=>{e.url&&((e,a)=>q({url:e,method:"get",params:a}))(e.url,t.value).then((e=>{r.value=e.data.records,o.value=e.data.total||0}))};s();const i=p(!1);let d=u({name:"",address:""});return{query:l,tableData:r,pageTotal:o,editVisible:i,form:d,handleSearch:()=>{l.pageNo=1,s()},handlePageChange:e=>{l.pageNo=e,s()},handleDelete:e=>{ElMessageBox.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{ElMessage.success("删除成功"),r.value.splice(e,1)})).catch((()=>{}))},handleEdit:e=>{a.emit("edit",e)},refresh:e=>{l.pageNo=1;for(const a in e)l[a]=e[a];s()},exportTable:()=>{((e,a)=>{q({url:e+"/export",method:"post",data:a,responseType:"blob"}).then((e=>{console.log(e);var a=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),l=document.createElement("a"),t=window.URL.createObjectURL(a);l.href=t,l.download="列表.xlsx",document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(t)}))})(e.url,t.value)}}}},x=w();i("data-v-5e8aef6c");const E=C(" 导出表格 "),O={key:1},T={key:1,class:"pagination"};d();const L=x(((e,a,l,t,r,o)=>{const s=m("el-button"),n=m("el-table-column"),i=m("el-table"),d=m("el-pagination");return b(),y("div",null,[l.needExport?(b(),y(s,{key:0,type:"primary",style:{float:"right","margin-bottom":"10px"},size:"small",onClick:t.exportTable},{default:x((()=>[E])),_:1},8,["onClick"])):g("",!0),v(i,{data:l.url?t.tableData:l.tableRealData,border:!l.noBorder,class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:x((()=>[(b(!0),y(f,null,h(l.cols,(a=>(b(),y(n,{key:a.prop,prop:a.prop,width:a.width||"",label:a.label},{default:x((l=>[a.slot?k(e.$slots,a.slot,{key:0,scopeData:l.row},void 0,!0):(b(),y("span",O,D(l.row[a.prop]),1))])),_:2},1032,["prop","width","label"])))),128)),l.needOperation?(b(),y(n,{key:0,label:"操作",width:"140"},{default:x((a=>[k(e.$slots,"operation",{scopeData:a.row},void 0,!0)])),_:1})):g("",!0)])),_:1},8,["data","border"]),l.noPager?g("",!0):(b(),y("div",T,[v(d,{background:"",layout:"total, prev, pager, next","current-page":t.query.pageNo,"page-size":t.query.pageSize,total:t.pageTotal,onCurrentChange:t.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])]))])}));_.render=L,_.__scopeId="data-v-5e8aef6c";const V={components:{BaseTable:_,ProductAdd:S},props:{serialNum:{type:String}},setup(e){const t=p({}),r=e=>{t.value.refresh(e)},o=p(!1);let s=p(null);const i=p(!1),d=p({}),u=p(!1),c=p(!1),m=p(!1),b=p(null);return{columns:[{label:"量具名称",prop:"name"},{label:"量具规格",prop:"specification"},{label:"量具编号",prop:"code"},{label:"归属序号",prop:"serialNum"},{label:"数量",prop:"numbers"},{label:"库房存放点",prop:"storage"},{label:"库房剩余数量",prop:"availableNums"},{label:"状态",prop:"status",slot:"status"},{label:"入库时间",prop:"putDate"},{label:"归还时间",prop:"returnDate"}],formItems:[{label:"量具名称",key:"name",required:!0},{label:"量具规格",key:"specification",required:!0},{label:"量具编号",key:"code",required:!1},{label:"归属序号",key:"serialNum",required:!0,placeholder:"请关联已存在的序号"},{label:"数量",type:"number",key:"numbers",required:!0},{label:"状态",key:"status",required:!0,type:"select",options:[{label:"在厂使用",value:"USE"},{label:"已归还甲方",value:"RETURN"}]},{label:"入库时间",key:"putDate",type:"date",required:!0},{label:"库房存放点",key:"storage",required:!1},{label:"归还时间",key:"returnDate",type:"date",required:!1}],editVisible:o,handleSearch:r,handleDelete:e=>{R.confirm("确定要删除吗？","提示",{type:"warning"}).then((async()=>{var a;await(a={mesureId:e.id},q({url:`/measures-manage/remove/${a.mesureId}`,method:"delete",data:a})),I.success("删除成功"),r()})).catch((()=>{}))},handleEdit:e=>{o.value=!0,s.value=e},showDetail:e=>{s.value=e,i.value=!0},editItemData:s,editSubmit:async e=>{var t,i,d,u;await(d=n({id:null==(t=s.value)?void 0:t.id},e),u={availableNums:e.numbers},i=a(d,l(u)),q({url:"/measures-manage/saveOrModify",method:"post",data:i})),I.success("操作成功"),o.value=!1,r()},handleAdd:()=>{console.log(111),o.value=!0,s.value=null},detailVisible:i,handleLendingRecords:e=>{s.value=e,u.value=!0},lendingRecordsColumns:[{label:"领用人",prop:"userName"},{label:"领用日期",prop:"created"},{label:"还回日期",prop:"returnDate"},{label:"备注",prop:"remark"}],lendingRecordsVisible:u,showAddLend:()=>{c.value=!0},addLendVisible:c,addLendFormItems:[{label:"领用人",key:"user",required:!0,type:"user"},{label:"领用数量",key:"nums",required:!0,type:"number"},{label:"备注",key:"remark",required:!0,type:"textarea"}],addLendSubmit:async e=>{var a;await(a=n({measure:s.value.id},e),q({url:"/measures-manage/claims/add",method:"post",data:a})),I.success("操作成功"),c.value=!1,d.value.refresh()},showReturnMesuring:e=>{m.value=!0,b.value=e},returnMesuringVisible:m,returnMesuringItems:[{label:"归还数量",key:"nums",required:!0,type:"number"}],returnMesuringSubmit:async e=>{var a;await(a=n({id:b.value.id},e),q({url:"/measures-manage/claims/ret",method:"put",params:a})),I.success("操作成功"),m.value=!1,d.value.refresh()},mesureTable:t,lendRecordsTable:d,handleLendRecordsDelete:e=>{R.confirm("确定要删除吗？","提示",{type:"warning"}).then((async()=>{var a;await(a={recordId:e.id},q({url:`/measures-manage/claims/remove/${a.recordId}`,method:"delete",data:a})),I.success("删除成功"),d.value.refresh()})).catch((()=>{}))}}}},N=w();i("data-v-4e6ec6b4");const B=C("领用记录 "),j=C("编辑 "),M=C("删除"),P=C(" 领用 "),U=C("归还 "),A=C("删除"),z={class:"dialog-footer"},$=C("关 闭");d();const F=N(((e,a,l,t,r,o)=>{const s=m("el-tag"),n=m("el-link"),i=m("el-button"),d=m("BaseTable"),u=m("el-dialog"),c=m("ProductAdd");return b(),y("div",null,[v(d,{cols:t.columns,ref:"mesureTable",needExport:"",url:"/measures-manage/list",queryBase:l.serialNum?{serialNum:l.serialNum}:{},onEdit:t.handleEdit},{status:N((e=>[v(s,{type:{USE:"danger",STORAGE:"primary",RETURN:"success"}[e.scopeData.status]},{default:N((()=>[C(D({USE:"在厂使用",STORAGE:"在库房",RETURN:"已归还甲方"}[e.scopeData.status]),1)])),_:2},1032,["type"])])),taskId:N((e=>[v(n,{href:"javascript:void(0)",type:"primary",onClick:a=>t.showDetail(e.scopeData)},{default:N((()=>[C(D(e.scopeData.taskId),1)])),_:2},1032,["onClick"])])),operation:N((e=>[v(i,{type:"text",icon:"el-icon-document",class:"color-success",onClick:a=>t.handleLendingRecords(e.scopeData)},{default:N((()=>[B])),_:2},1032,["onClick"]),v(i,{type:"text",icon:"el-icon-edit",style:{"margin-left":"0"},onClick:a=>t.handleEdit(e.scopeData)},{default:N((()=>[j])),_:2},1032,["onClick"]),v(i,{type:"text",icon:"el-icon-delete",class:"color-danger",onClick:a=>t.handleDelete(e.scopeData)},{default:N((()=>[M])),_:2},1032,["onClick"])])),_:1},8,["cols","queryBase","onEdit"]),v(u,{title:`领用记录 - ${t.editItemData&&t.editItemData.name}`,modelValue:t.lendingRecordsVisible,"onUpdate:modelValue":a[2]||(a[2]=e=>t.lendingRecordsVisible=e),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"60%"},{footer:N((()=>[v("span",z,[v(i,{onClick:a[1]||(a[1]=e=>t.lendingRecordsVisible=!1)},{default:N((()=>[$])),_:1})])])),default:N((()=>{var e;return[v(i,{type:"primary",icon:"el-icon-plus",style:{"margin-bottom":"20px"},onClick:t.showAddLend},{default:N((()=>[P])),_:1},8,["onClick"]),v(d,{cols:t.lendingRecordsColumns,ref:"lendRecordsTable",queryBase:{measure:null==(e=t.editItemData)?void 0:e.id},url:"/measures-manage/claims"},{operation:N((e=>[e.scopeData.returnDate?g("",!0):(b(),y(i,{key:0,type:"text",icon:"el-icon-download",class:"color-success",onClick:a=>t.showReturnMesuring(e.scopeData)},{default:N((()=>[U])),_:2},1032,["onClick"])),v(i,{type:"text",icon:"el-icon-delete",class:"color-danger",onClick:a=>t.handleLendRecordsDelete(e.scopeData)},{default:N((()=>[A])),_:2},1032,["onClick"])])),_:1},8,["cols","queryBase"])]})),_:1},8,["title","modelValue"]),v(c,{visible:t.editVisible,onClose:a[3]||(a[3]=e=>t.editVisible=!1),itemData:t.editItemData,formItems:t.formItems,key:"product-edit",onDialogSubmit:t.editSubmit},null,8,["visible","itemData","formItems","onDialogSubmit"]),v(c,{visible:t.addLendVisible,onClose:a[4]||(a[4]=e=>t.addLendVisible=!1),formItems:t.addLendFormItems,key:"lend-add",propTitle:"领用量具",onDialogSubmit:t.addLendSubmit},null,8,["visible","formItems","onDialogSubmit"]),v(c,{visible:t.returnMesuringVisible,onClose:a[5]||(a[5]=e=>t.returnMesuringVisible=!1),formItems:t.returnMesuringItems,propTitle:"归还量具",onDialogSubmit:t.returnMesuringSubmit},null,8,["visible","formItems","onDialogSubmit"])])}));V.render=F,V.__scopeId="data-v-4e6ec6b4";export{_,V as a};
