var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,n=(e,a)=>{for(var l in a||(a={}))r.call(a,l)&&o(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&o(e,l,a[l]);return e};import{p as i,i as d,j as u,d as c,r as p,o as m,c as b,f as y,F as g,g as f,H as v,t as h,s as D,h as k,m as w,L as C,w as I}from"./vendor.b5aa390e.js";import{s as _,_ as R}from"./index.4d78699e.js";const S={name:"basetable",props:{cols:{type:Array,required:!0},url:{type:String},tableRealData:{type:Array},needOperation:{type:Boolean,default:!0},noBorder:{type:Boolean,default:!1},noPager:{type:Boolean,default:!1},queryBase:{type:Object,default:()=>{}}},setup(e,a){const l=u({pageNo:1,pageSize:10}),t=c([]),r=c(0),s=()=>{e.url&&((e,a)=>_({url:e,method:"get",params:a}))(e.url,n(n({},l),e.queryBase)).then((e=>{t.value=e.data.records,r.value=e.data.total||0}))};s();const o=c(!1);let i=u({name:"",address:""});return{query:l,tableData:t,pageTotal:r,editVisible:o,form:i,handleSearch:()=>{l.pageNo=1,s()},handlePageChange:e=>{l.pageNo=e,s()},handleDelete:e=>{ElMessageBox.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{ElMessage.success("删除成功"),t.value.splice(e,1)})).catch((()=>{}))},handleEdit:e=>{a.emit("edit",e)},refresh:e=>{l.pageNo=1;for(const a in e)l[a]=e[a];s()}}}},q=k();i("data-v-78f58318");const V=w(" 导出表格"),E=y("i",{class:"el-icon-arrow-down el-icon--right"},null,-1),N=w("导出当页"),T=w("导出全部"),O={key:1},B={key:0,class:"pagination"};d();const L=q(((e,a,l,t,r,s)=>{const o=p("el-button"),n=p("el-dropdown-item"),i=p("el-dropdown-menu"),d=p("el-dropdown"),u=p("el-table-column"),c=p("el-table"),k=p("el-pagination");return m(),b("div",null,[y(d,{style:{float:"right","margin-bottom":"10px"}},{dropdown:q((()=>[y(i,null,{default:q((()=>[y(n,null,{default:q((()=>[N])),_:1}),y(n,null,{default:q((()=>[T])),_:1})])),_:1})])),default:q((()=>[y(o,{type:"primary",size:"small"},{default:q((()=>[V,E])),_:1})])),_:1}),y(c,{data:l.url?t.tableData:l.tableRealData,border:!l.noBorder,class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:q((()=>[(m(!0),b(g,null,f(l.cols,(a=>(m(),b(u,{key:a.prop,prop:a.prop,width:a.width||"",label:a.label},{default:q((l=>[a.slot?v(e.$slots,a.slot,{key:0,scopeData:l.row},void 0,!0):(m(),b("span",O,h(l.row[a.prop]),1))])),_:2},1032,["prop","width","label"])))),128)),l.needOperation?(m(),b(u,{key:0,label:"操作",width:"140"},{default:q((a=>[v(e.$slots,"operation",{scopeData:a.row},void 0,!0)])),_:1})):D("",!0)])),_:1},8,["data","border"]),l.noPager?D("",!0):(m(),b("div",B,[y(k,{background:"",layout:"total, prev, pager, next","current-page":t.query.pageNo,"page-size":t.query.pageSize,total:t.pageTotal,onCurrentChange:t.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])]))])}));S.render=L,S.__scopeId="data-v-78f58318";const x={components:{BaseTable:S,ProductAdd:R},props:{serialNum:{type:String}},setup(e){const t=c({}),r=e=>{t.value.refresh(e)},s=c(!1);let o=c(null);const i=c(!1),d=c({}),u=c(!1),p=c(!1),m=c(!1),b=c(null);return{columns:[{label:"量具名称",prop:"name"},{label:"量具规格",prop:"specification"},{label:"量具编号",prop:"code"},{label:"归属序号",prop:"serialNum"},{label:"数量",prop:"numbers"},{label:"库房剩余数量",prop:"availableNums"},{label:"状态",prop:"status",slot:"status"},{label:"入库时间",prop:"putDate"},{label:"归还时间",prop:"returnDate"}],formItems:[{label:"量具名称",key:"name",required:!0},{label:"量具规格",key:"specification",required:!0},{label:"量具编号",key:"code",required:!0},{label:"归属序号",key:"serialNum",required:!0,placeholder:"请关联已存在的序号"},{label:"数量",type:"number",key:"numbers",required:!0},{label:"状态",key:"status",required:!0,type:"select",options:[{label:"在厂使用",value:"USE"},{label:"已归还甲方",value:"RETURN"}]},{label:"入库时间",key:"putDate",type:"date",required:!0},{label:"归还时间",key:"returnDate",type:"date",required:!1}],editVisible:s,handleSearch:r,handleDelete:e=>{C.confirm("确定要删除吗？","提示",{type:"warning"}).then((async()=>{var a;await(a={mesureId:e.id},_({url:`/measures-manage/remove/${a.mesureId}`,method:"delete",data:a})),I.success("删除成功"),r()})).catch((()=>{}))},handleEdit:e=>{s.value=!0,o.value=e},showDetail:e=>{o.value=e,i.value=!0},editItemData:o,editSubmit:async e=>{var t,i,d,u;await(d=n({id:null==(t=o.value)?void 0:t.id},e),u={availableNums:e.numbers},i=a(d,l(u)),_({url:"/measures-manage/saveOrModify",method:"post",data:i})),I.success("操作成功"),s.value=!1,r()},handleAdd:()=>{console.log(111),s.value=!0,o.value=null},detailVisible:i,handleLendingRecords:e=>{o.value=e,u.value=!0},lendingRecordsColumns:[{label:"领用人",prop:"userName"},{label:"领用日期",prop:"created"},{label:"还回日期",prop:"returnDate"},{label:"备注",prop:"remark"}],lendingRecordsVisible:u,showAddLend:()=>{p.value=!0},addLendVisible:p,addLendFormItems:[{label:"领用人",key:"user",required:!0,type:"user"},{label:"领用数量",key:"nums",required:!0,type:"number"},{label:"备注",key:"remark",required:!0,type:"textarea"}],addLendSubmit:async e=>{var a;await(a=n({measure:o.value.id},e),_({url:"/measures-manage/claims/add",method:"post",data:a})),I.success("操作成功"),p.value=!1,d.value.refresh()},showReturnMesuring:e=>{m.value=!0,b.value=e},returnMesuringVisible:m,returnMesuringItems:[{label:"归还数量",key:"nums",required:!0,type:"number"}],returnMesuringSubmit:async e=>{var a;await(a=n({id:b.value.id},e),_({url:"/measures-manage/claims/ret",method:"put",params:a})),I.success("操作成功"),m.value=!1,d.value.refresh()},mesureTable:t,lendRecordsTable:d,handleLendRecordsDelete:e=>{C.confirm("确定要删除吗？","提示",{type:"warning"}).then((async()=>{var a;await(a={recordId:e.id},_({url:`/measures-manage/claims/remove/${a.recordId}`,method:"delete",data:a})),I.success("删除成功"),d.value.refresh()})).catch((()=>{}))}}}},M=k();i("data-v-4a55ca06");const j=w("领用记录 "),P=w("编辑 "),A=w("删除"),U=w(" 领用 "),z=w("归还 "),$=w("删除"),F={class:"dialog-footer"},G=w("关 闭");d();const H=M(((e,a,l,t,r,s)=>{const o=p("el-tag"),n=p("el-link"),i=p("el-button"),d=p("BaseTable"),u=p("el-dialog"),c=p("ProductAdd");return m(),b("div",null,[y(d,{cols:t.columns,ref:"mesureTable",url:"/measures-manage/list",queryBase:l.serialNum?{serialNum:l.serialNum}:{},onEdit:t.handleEdit},{status:M((e=>[y(o,{type:{USE:"danger",STORAGE:"primary",RETURN:"success"}[e.scopeData.status]},{default:M((()=>[w(h({USE:"在厂使用",STORAGE:"在库房",RETURN:"已归还甲方"}[e.scopeData.status]),1)])),_:2},1032,["type"])])),taskId:M((e=>[y(n,{href:"javascript:void(0)",type:"primary",onClick:a=>t.showDetail(e.scopeData)},{default:M((()=>[w(h(e.scopeData.taskId),1)])),_:2},1032,["onClick"])])),operation:M((e=>[y(i,{type:"text",icon:"el-icon-document",class:"color-success",onClick:a=>t.handleLendingRecords(e.scopeData)},{default:M((()=>[j])),_:2},1032,["onClick"]),y(i,{type:"text",icon:"el-icon-edit",style:{"margin-left":"0"},onClick:a=>t.handleEdit(e.scopeData)},{default:M((()=>[P])),_:2},1032,["onClick"]),y(i,{type:"text",icon:"el-icon-delete",class:"color-danger",onClick:a=>t.handleDelete(e.scopeData)},{default:M((()=>[A])),_:2},1032,["onClick"])])),_:1},8,["cols","queryBase","onEdit"]),y(u,{title:`领用记录 - ${t.editItemData&&t.editItemData.name}`,modelValue:t.lendingRecordsVisible,"onUpdate:modelValue":a[2]||(a[2]=e=>t.lendingRecordsVisible=e),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"60%"},{footer:M((()=>[y("span",F,[y(i,{onClick:a[1]||(a[1]=e=>t.lendingRecordsVisible=!1)},{default:M((()=>[G])),_:1})])])),default:M((()=>{var e;return[y(i,{type:"primary",icon:"el-icon-plus",style:{"margin-bottom":"20px"},onClick:t.showAddLend},{default:M((()=>[U])),_:1},8,["onClick"]),y(d,{cols:t.lendingRecordsColumns,ref:"lendRecordsTable",queryBase:{measure:null==(e=t.editItemData)?void 0:e.id},url:"/measures-manage/claims"},{operation:M((e=>[e.scopeData.returnDate?D("",!0):(m(),b(i,{key:0,type:"text",icon:"el-icon-download",class:"color-success",onClick:a=>t.showReturnMesuring(e.scopeData)},{default:M((()=>[z])),_:2},1032,["onClick"])),y(i,{type:"text",icon:"el-icon-delete",class:"color-danger",onClick:a=>t.handleLendRecordsDelete(e.scopeData)},{default:M((()=>[$])),_:2},1032,["onClick"])])),_:1},8,["cols","queryBase"])]})),_:1},8,["title","modelValue"]),y(c,{visible:t.editVisible,onClose:a[3]||(a[3]=e=>t.editVisible=!1),itemData:t.editItemData,formItems:t.formItems,key:"product-edit",onDialogSubmit:t.editSubmit},null,8,["visible","itemData","formItems","onDialogSubmit"]),y(c,{visible:t.addLendVisible,onClose:a[4]||(a[4]=e=>t.addLendVisible=!1),formItems:t.addLendFormItems,key:"lend-add",propTitle:"领用量具",onDialogSubmit:t.addLendSubmit},null,8,["visible","formItems","onDialogSubmit"]),y(c,{visible:t.returnMesuringVisible,onClose:a[5]||(a[5]=e=>t.returnMesuringVisible=!1),formItems:t.returnMesuringItems,propTitle:"归还量具",onDialogSubmit:t.returnMesuringSubmit},null,8,["visible","formItems","onDialogSubmit"])])}));x.render=H,x.__scopeId="data-v-4a55ca06";export{S as _,x as a};
