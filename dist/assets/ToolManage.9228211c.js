var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(l,a,o)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o,s=(e,l)=>{for(var a in l||(l={}))t.call(l,a)&&r(e,a,l[a]);if(o)for(var a of o(l))i.call(l,a)&&r(e,a,l[a]);return e};import{m as n,a as d,b as u,i as c,p,h as m,L as y,w as b,r as f,o as v,c as h,e as k,l as g,t as D,q as I,g as V}from"./vendor.86c6712b.js";import{_ as C}from"./MesuringTable.4017a123.js";import{_ as q,d as _,e as R,l as T,r as S,b as B,c as w,f as O}from"./index.b3e4d661.js";import{a as j}from"./ProductDetail.c646594c.js";const N={components:{BaseTable:C,ProductAdd:q,ProductDetail:j},name:"product-manage",beforeRouteUpdate(e,l,a){"tool"==e.name&&(this.toolTypeId=e.query.id,this.initToolInfo()),a()},setup(){const e=n(),o=d(),t=u(),i=u(),r=u(null),p=u({}),m=()=>{r.value||(r.value=e.query.id),t.value=[{label:"采购单位",prop:"purchaseUnit",slot:"purchaseUnit"},{label:"名称",prop:"name"},{label:"规格型号",prop:"specification"},{label:"库房存放点",prop:"locations"},{label:"库房剩余数量",prop:"availableNum"},{label:"总购数量",prop:"totalBuy"}],i.value=[{label:"采购单位",key:"purchaseUnit",required:!0},{label:"名称",key:"name",required:!0},{label:"规格型号",key:"specification",required:!0},{label:"库房存放点",key:"locations",required:!0},{label:"库房剩余数量",key:"availableNum",required:!0},{label:"总购数量",key:"totalBuy",required:!0}],setTimeout((()=>{var l;p.value=o.state.toolTypes.find((l=>l.id==e.query.id)),(null==(l=p.value)?void 0:l.specField)&&p.value.specField.split("|").forEach(((e,l)=>{t.value.push({label:e,prop:"key"+l,slot:"key"+l}),i.value.push({label:e,key:"key"+l,required:!1})}))}),500)};m();const f=u({}),v=c({name:"",specification:""}),h=()=>{f.value.refresh(v)},k=u(!1);let g=u(null);const D=u(!1),I=u(!1),V=u({}),C=u(!1),q=u(!1),j=u(null),N=u(!1),L=e=>{N.value=!0,g.value=e},U=c({name:"",specification:""}),F=u({}),x=()=>{F.value.refresh(U)},M=u(!1);return{toolTypeId:r,toolTypeInfo:p,columns:t,formItems:i,query:v,toolTable:f,editVisible:k,handleSearch:h,handleDelete:e=>{y.confirm("确定要删除吗？","提示",{type:"warning"}).then((async()=>{await _({toolId:e.id}),b.success("删除成功"),h()})).catch((()=>{}))},handleEdit:e=>{k.value=!0,g.value=e},showDetail:e=>{g.value=e,D.value=!0},editItemData:g,editSubmit:async e=>{var o;let t={};var i,n;p.value.specField.split("|").forEach(((l,a)=>{t[l]=e["key"+a],delete e["key"+a]})),await R((i=s({toolType:r.value,id:null==(o=g.value)?void 0:o.id},e),n={specialField:JSON.stringify(t)},l(i,a(n)))),b.success("添加成功"),k.value=!1,h()},handleAdd:()=>{k.value=!0,g.value=null},detailVisible:D,handleLendingRecords:e=>{I.value=!0,g.value=e},lendingRecordsColumns:[{label:"领用人",prop:"userName"},{label:"领用日期",prop:"created"},{label:"领用数量",prop:"useNumber"},{label:"归还数量",prop:"retNum"},{label:"归还时间",prop:"retTime"},{label:"备注",prop:"remark"}],lendingRecordsVisible:I,showAddLend:e=>{C.value=!0},addLendVisible:C,lendRecordTable:V,addLendFormItems:[{label:"领用人",key:"user",required:!0,type:"user"},{label:"领用数量",key:"number",required:!0,type:"number"},{label:"备注",key:"remark",required:!0,type:"textarea"}],addLendSubmit:async e=>{var l;await T(s({tool:null==(l=g.value)?void 0:l.id},e)),b.success("领用成功"),C.value=!1,V.value.refresh()},showReturnMesuring:e=>{q.value=!0,j.value=e},returnMesuringVisible:q,returnMesuringItems:[{label:"归还数量",key:"nums",required:!0,type:"number"}],returnMesuringSubmit:async e=>{var l;await S(s({id:null==(l=j.value)?void 0:l.id},e)),b.success("归还成功"),q.value=!1,V.value.refresh()},handleLendRecordDelete:e=>{y.confirm("确定要删除吗？","提示",{type:"warning"}).then((async()=>{await B({recordId:e.id}),b.success("删除成功"),V.value.refresh()})).catch((()=>{}))},handBuyRecords:L,handBuyRecords:L,buyQuery:U,buyRecordTable:F,handleBuySearch:x,addBuyVisible:M,showAddBuy:e=>{M.value=!0,g.value=e},addBuySubmit:async e=>{var l;await w(s({tool:null==(l=g.value)?void 0:l.id},e)),b.success("添加成功"),M.value=!1,h()},buyRecordsVisible:N,handleBuyRecordDelete:e=>{y.confirm("确定要删除吗？","提示",{type:"warning"}).then((async()=>{await O({recordId:e.id}),b.success("删除成功"),x(),h()})).catch((()=>{}))},buyRecordsColumns:[{label:"采购单位",prop:"makeCompany"},{label:"名称",prop:"cutterName"},{label:"规格型号",prop:"specification"},{label:"采购时间",prop:"buyDate"},{label:"采购数量",prop:"nums"},{label:"采购单价",prop:"price"},{label:"回厂时间",prop:"returnDate"}],addBuyFormItems:[{label:"采购时间",key:"buyDate",required:!0,type:"date"},{label:"采购数量",key:"nums",required:!0},{label:"采购单价",key:"price",required:!0},{label:"回厂时间",key:"returnDate",required:!0,type:"date"}],initToolInfo:m}}},L=V();p("data-v-5fa74d62");const U={class:"container"},F=g("查询"),x=g("领用记录 "),M=g("添加采购记录 "),P=g("删除"),A=g(" 领用 "),E=g("归还 "),J=g("删除"),Q={class:"dialog-footer"},$=g("关 闭"),z=g("查询"),G=g("删除"),H={class:"dialog-footer"},K=g("关 闭");m();const W=L(((e,l,a,o,t,i)=>{const r=f("el-input"),s=f("el-form-item"),n=f("el-button"),d=f("el-form"),u=f("el-link"),c=f("BaseTable"),p=f("ProductAdd"),m=f("el-dialog");return o.toolTypeInfo.name?(v(),h("div",{key:o.toolTypeId},[k("div",U,[k(d,{inline:!0,model:o.query,class:"demo-form-inline"},{default:L((()=>[k(s,{label:"名称"},{default:L((()=>[k(r,{modelValue:o.query.name,"onUpdate:modelValue":l[1]||(l[1]=e=>o.query.name=e),placeholder:"名称"},null,8,["modelValue"])])),_:1}),k(s,{label:"规格型号"},{default:L((()=>[k(r,{modelValue:o.query.specification,"onUpdate:modelValue":l[2]||(l[2]=e=>o.query.specification=e),placeholder:"规格型号"},null,8,["modelValue"])])),_:1}),k(s,null,{default:L((()=>[k(n,{type:"primary",onClick:o.handleSearch},{default:L((()=>[F])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),k(n,{type:"primary",icon:"el-icon-plus",style:{"margin-bottom":"20px"},onClick:o.handleAdd},{default:L((()=>[g(D(`添加${o.toolTypeInfo.name}`),1)])),_:1},8,["onClick"]),k(c,{cols:o.columns,url:"/tool-manage/tool/pages",ref:"toolTable",queryBase:{toolType:o.toolTypeId},onEdit:o.handleEdit},{purchaseUnit:L((e=>[k(u,{href:"javascript:void(0)",type:"primary",onClick:l=>o.handBuyRecords(e.scopeData)},{default:L((()=>[g(D(e.scopeData.purchaseUnit),1)])),_:2},1032,["onClick"])])),key0:L((e=>[k("span",null,D(Object.entries(JSON.parse(e.scopeData.specialField))[0][1]),1)])),key1:L((e=>[k("span",null,D(Object.entries(JSON.parse(e.scopeData.specialField))[1][1]),1)])),key2:L((e=>[k("span",null,D(Object.entries(JSON.parse(e.scopeData.specialField))[2][1]),1)])),key3:L((e=>[k("span",null,D(Object.entries(JSON.parse(e.scopeData.specialField))[3][1]),1)])),key4:L((e=>[k("span",null,D(Object.entries(JSON.parse(e.scopeData.specialField))[4][1]),1)])),operation:L((e=>[k(n,{type:"text",icon:"el-icon-document",class:"color-success",onClick:l=>o.handleLendingRecords(e.scopeData)},{default:L((()=>[x])),_:2},1032,["onClick"]),k(n,{type:"text",icon:"el-icon-goods",style:{"margin-left":"0"},onClick:l=>o.showAddBuy(e.scopeData)},{default:L((()=>[M])),_:2},1032,["onClick"]),k(n,{type:"text",icon:"el-icon-delete",style:{"margin-left":"0"},class:"color-danger",onClick:l=>o.handleDelete(e.scopeData)},{default:L((()=>[P])),_:2},1032,["onClick"])])),_:1},8,["cols","queryBase","onEdit"])]),k(p,{visible:o.editVisible,onClose:l[3]||(l[3]=e=>o.editVisible=!1),itemData:o.editItemData,formItems:o.formItems,onDialogSubmit:o.editSubmit},null,8,["visible","itemData","formItems","onDialogSubmit"]),k(p,{visible:o.addBuyVisible,onClose:l[4]||(l[4]=e=>o.addBuyVisible=!1),formItems:o.addBuyFormItems,propTitle:"添加购买记录",onDialogSubmit:o.addBuySubmit},null,8,["visible","formItems","onDialogSubmit"]),k(m,{title:`领用记录 - ${o.editItemData&&o.editItemData.name}`,modelValue:o.lendingRecordsVisible,"onUpdate:modelValue":l[8]||(l[8]=e=>o.lendingRecordsVisible=e),"destroy-on-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"60%"},{footer:L((()=>[k("span",Q,[k(n,{onClick:l[5]||(l[5]=e=>o.lendingRecordsVisible=!1)},{default:L((()=>[$])),_:1})])])),default:L((()=>[k(n,{type:"primary",icon:"el-icon-plus",style:{"margin-bottom":"20px"},onClick:o.showAddLend},{default:L((()=>[A])),_:1},8,["onClick"]),k(c,{cols:o.lendingRecordsColumns,ref:"lendRecordTable",queryBase:{tool:o.editItemData.id},url:"/tool-manage/claims/page"},{operation:L((e=>[!e.scopeData.retNum||e.scopeData.useNumber>e.scopeData.retNum?(v(),h(n,{key:0,type:"text",icon:"el-icon-download",class:"color-success",onClick:l=>o.showReturnMesuring(e.scopeData)},{default:L((()=>[E])),_:2},1032,["onClick"])):I("",!0),k(n,{type:"text",icon:"el-icon-delete",class:"color-danger",onClick:l=>o.handleLendRecordDelete(e.scopeData)},{default:L((()=>[J])),_:2},1032,["onClick"])])),_:1},8,["cols","queryBase"]),k(p,{visible:o.addLendVisible,onClose:l[6]||(l[6]=e=>o.addLendVisible=!1),formItems:o.addLendFormItems,propTitle:"领用工具",onDialogSubmit:o.addLendSubmit},null,8,["visible","formItems","onDialogSubmit"]),k(p,{visible:o.returnMesuringVisible,onClose:l[7]||(l[7]=e=>o.returnMesuringVisible=!1),formItems:o.returnMesuringItems,propTitle:"归还工具",onDialogSubmit:o.returnMesuringSubmit},null,8,["visible","formItems","onDialogSubmit"])])),_:1},8,["title","modelValue"]),k(m,{title:`采购记录 - ${o.editItemData&&o.editItemData.purchaseUnit}`,modelValue:o.buyRecordsVisible,"onUpdate:modelValue":l[12]||(l[12]=e=>o.buyRecordsVisible=e),"destroy-on-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"80%"},{footer:L((()=>[k("span",H,[k(n,{onClick:l[11]||(l[11]=e=>o.buyRecordsVisible=!1)},{default:L((()=>[K])),_:1})])])),default:L((()=>[k(d,{inline:!0,model:o.buyQuery,class:"demo-form-inline"},{default:L((()=>[k(s,{label:"工具名称"},{default:L((()=>[k(r,{modelValue:o.buyQuery.name,"onUpdate:modelValue":l[9]||(l[9]=e=>o.buyQuery.name=e),placeholder:"工具名称"},null,8,["modelValue"])])),_:1}),k(s,{label:"规格型号"},{default:L((()=>[k(r,{modelValue:o.buyQuery.specification,"onUpdate:modelValue":l[10]||(l[10]=e=>o.buyQuery.specification=e),placeholder:"规格型号"},null,8,["modelValue"])])),_:1}),k(s,null,{default:L((()=>[k(n,{type:"primary",onClick:o.handleBuySearch},{default:L((()=>[z])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),k(c,{cols:o.buyRecordsColumns,ref:"buyRecordTable",queryBase:{toolType:o.toolTypeId,companyName:o.editItemData.purchaseUnit},url:"/tool-manage/buy/record/pages"},{operation:L((e=>[k(n,{type:"text",icon:"el-icon-delete",class:"color-danger",onClick:l=>o.handleBuyRecordDelete(e.scopeData)},{default:L((()=>[G])),_:2},1032,["onClick"])])),_:1},8,["cols","queryBase"])])),_:1},8,["title","modelValue"])])):I("",!0)}));N.render=W,N.__scopeId="data-v-5fa74d62";export default N;
